<?R
    tab = expand.grid(sizer=c(2,4), k_material=c(1e-4), collision=c("Cumulants","CM_HIGHER"))

    dir_name <- "batch_ruraWrurze_DirichletBC"
    dir.create(dir_name)

    tab$name = paste0("Dirichlet_pipeInPipe_", tab$collision,"_k_", tab$k_material, "_size_",32*tab$sizer, "lu")
    tab$xml = paste0(paste0(dir_name,"/",tab$name),".xml")
    tab$output = paste0(paste0("output/",dir_name,"/",tab$name,"/"))

    # tab$output = paste0(paste0("/net/scratch/people/plgmuaddieb/output/",dir_name,"/",tab$name,"/"))

    write.csv(tab, "ruraWrurze_variable_k_template.csv", row.names=FALSE)
    for (i in 1:nrow(tab)) {
        attach(tab[i,,drop=FALSE])
        print(xml)
        sink(xml) # save to a .xml file
?>

<?xml version="1.0"?>
<CLBConfig version="2.0" output="output/">
	<Units>
    <Params size="1m" gauge="<?%f sizer ?>"/>
  </Units>
	<Geometry nx="<?%f 32*sizer ?>" ny="<?%f 32*sizer ?>" nz="3" >  
     	<HeaterDirichletTemperatureEQ mask="COLLISION" name="dirichlet_cold"> 
            <Box />
        </HeaterDirichletTemperatureEQ>

     	<<?%s collision ?>>
     		<Cylinder ny="<?%f 30*sizer ?>" nx="<?%f 30*sizer ?>" dx="<?%f 1*sizer ?>" dy="<?%f 1*sizer ?>"/>
     	</<?%s collision ?>>    

		<None mask="ADDITIONALS_HEAT">
			<Cylinder ny="<?%f 30*sizer ?>" nx="<?%f 30*sizer ?>" dx="<?%f 1*sizer ?>" dy="<?%f 1*sizer ?>"/>
		</None>

        <HeaterDirichletTemperatureEQ mask="COLLISION" name="dirichlet_hot"> 
        	<Cylinder ny="<?%f 8*sizer ?>" nx="<?%f 8*sizer ?>" dx="<?%f 12*sizer ?>" dy="<?%f 12*sizer ?>"/>
        </HeaterDirichletTemperatureEQ> 

<!--       	<DarcySolid name="darcy_solid_region">
        	<Cylinder ny="20m" nx="20m" dx="6m" dy="6m"/>
      	</DarcySolid>   -->
	</Geometry>
    <Model>
	    <Params
	    	h_stability_enhancement="1."

	        conductivity="<?%f k_material ?>" 
	        cp="1"
			material_density="1"

	        InitTemperature="10.0"
	        InitTemperature-dirichlet_hot="11.0"
	        InitTemperature-dirichlet_cold="10.0"
	        />
	    <Params />
    </Model> 

<!-- <Solve Iterations="10" > <VTK Iterations="1"/> </Solve> -->
	<Failcheck Iterations="1000" nx="<?%f 32*sizer ?>" ny="<?%f 32*sizer ?>" nz="3" />
	<Solve Iterations="100000">
		<VTK Iterations="5000" />
	</Solve>
</CLBConfig>


<?R
    sink()
    detach()
}
?>
