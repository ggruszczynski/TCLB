

<?R
    tab = expand.grid(
        sizer=c(4, 2, 1, 0.5, 0.25), 
        D0_stl=c(100), # cylinder's diameter in the stl file
        grid_scale=c(0.32), # no of lattice units describing the cylinder 
        bc=c("HeaterDirichletTemperatureIABB"), # "HeaterDirichletTemperatureIABB", "HeaterDirichletTemperatureEQ","HeaterNeumannHeatFluxCylinder"
        hpc=c("no"),
        nu=c(0.005), 
        k=c(0.005/0.7),
        Re=c(100)
    )

    dir_name <-"batch_HotKarman_Re1000" 
    dir.create(dir_name)
    tab$name = paste0(
                      "batch_HotKarman_Re", tab$Re,"_D0_", formatC(tab$D0_stl*tab$sizer*tab$grid_scale,digits = 2, format = "e"), "_nu_", tab$nu, 
                      "_U_", formatC(tab$Re*tab$nu/(tab$sizer*tab$grid_scale*tab$D0_stl),digits = 2, format = "e"), 
                      "_bc_", tab$bc)

    tab$xml = paste0(paste0(dir_name,"/",tab$name),".xml")

    if(tab$hpc=="yes")
    {
        tab$output = paste0(paste0("/net/scratch/people/plgmuaddieb/output/",dir_name,"/",tab$name, "/"))
    } else {
        tab$output = paste0(paste0("output/",dir_name,"/",tab$name,"/"))
    }

    options(digits=10)
    write.csv(tab, "JFM_DDF_template.csv", row.names=FALSE)
    for (i in 1:nrow(tab)) {
        attach(tab[i,,drop=FALSE])
        print(xml)
        sink(xml) # save to a .xml file
?>

<!-- 
See
`Two-dimensional simulation of unsteady heat transfer from a circular cylinder in crossflow`
by Dalsem Bouhaire and Vincent H. Chu
J. Fluid. Mech. vol. 570, pp177-215, 2007
This is a 2D-hack
 -->

<?xml version="1.0"?>
<CLBConfig version="2.0" output="<?%s output ?>">
    <Geometry nx="<?%f 672*sizer ?>" ny="<?%f 192*sizer ?>" nz="3" >   
        <CM_HIGHER><Box/></CM_HIGHER>
            <!--            
            <Wall mask="ALL">
            <STL file="WIP/Benchmarks/HotKarman_Re1000/cylinder_noXY_D100_Z9.stl" 
              scale="<?%f sizer*grid_scale ?>" 
              Xrot="0d" 
              x="<?%f sizer*grid_scale*0.25*672 ?>" 
              y="<?%f sizer*grid_scale*0.5*192 ?>" 
              z="0" 
              side="surface"/>
            </Wall> -->

        <WVelocity name="Inlet"><Box nx="1"/></WVelocity>
        <!-- <EPressure name="Outlet"><Box dx="-1"/></EPressure> -->
        <ENeumann name="Outlet"><Box dx="-1"/></ENeumann>

        <<?%s bc ?> name="BC_heat_cylinder"> 
            <STL file="WIP/Benchmarks/HotKarman_Re1000/cylinder_noXY_D100_Z9.stl" 
              scale="<?%f sizer*grid_scale ?>" 
              Xrot="0d" 
              x="<?%f sizer*0.25*672 ?>" 
              y="<?%f sizer*0.5*192 ?>" 
              z="0" 
              side="surface"/>
        </<?%s bc ?>>  

        <FluxMeasurment>
            <!-- <Outlet/> -->
            <Box dx="-1"/>
<!--             <STL file="WIP/Benchmarks/HotKarman_Re1000/cylinder_noXY_D100_Z9.stl" 
              scale="<?%f sizer*grid_scale ?>" 
              Xrot="0d" 
               x="<?%f sizer*0.25*672 ?>" 
              y="<?%f sizer*0.5*192 ?>" 
              z="0" 
              side="surface"/> -->
        </FluxMeasurment>
    </Geometry>
    <Model>
        <Params
          InitTemperature="0"
          InitTemperature-Inlet="0"
          InitTemperature-Outlet="0"
          InitTemperature-BC_heat_cylinder="1"

          InitHeatFlux-BC_heat_cylinder="0.001"
        />

      <Params 
        nu="<?%f nu ?>"
        conductivity="<?%f k ?>"

        nu_buffer="0.166666"
        conductivity_buffer="0.166666"

        h_stability_enhancement="1."
        cp="1."
        material_density="1."
      />

      <Params VelocityX="<?%f Re*nu/(sizer*grid_scale*D0_stl) ?>" />

      <!-- CylinderCenter is used only for heat flux bc -->
      <Params CylinderCenterX="<?%f sizer*grid_scale*0.25*672 ?>" />
      <Params CylinderCenterY="<?%f sizer*grid_scale*0.5*192 ?>"/> 
    
    </Model>
   
    <Solve Iterations="3">  <VTK Iterations="1"/> </Solve > 
    <Failcheck Iterations="5000" nx="<?%f 672*sizer ?>" ny="<?%f 192*sizer ?>" nz="3" />

    <Solve Iterations="20000"> 
        <VTK Iterations="1000" what="H,T,U,Rho,averageT,averageU"/> 
        <Average Iterations="1000"/>
        <Log Iterations="2000"/>
    </Solve>
    

    <Failcheck Iterations="5000" nx="<?%f 672*sizer ?>" ny="<?%f 192*sizer ?>" nz="3" />
    <Solve Iterations="500000" > <Log Iterations="2000"/> </Solve>
    
    <Solve Iterations="10000"> 
        <VTK Iterations="1000" what="H,T,U,Rho,averageT,averageU"/> 
        <Average Iterations="1000"/>
        <Log Iterations="2000"/>
    </Solve>
    <!-- <SaveMemoryDump Iterations="250000" file="test.tclbdump"/> -->
  </CLBConfig>


<?R
    sink()
    detach()
}
?>
