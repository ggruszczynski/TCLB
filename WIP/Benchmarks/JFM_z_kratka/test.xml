<!-- 
See
`Direct numerical simulation of heat transfer from a cylinder immersed in the production and decay regions of grid-element turbulence`
by I. Paul, G. Papadakis, J.C. Vassilicos
J. Fluid. Mech. vol. 847, pp452-488, 2018
 -->

<?R
    tab = expand.grid(
        sizer=c(1, 0.5, 0.25), 
        t0=c(43), 
        grid_scale=c(0.42123738481790257), 
        bc=c("HeaterDirichletTemperatureIABB"), # "HeaterDirichletTemperatureEQ","HeaterNeumannHeatFluxCylinder"
        hpc=c("no"),
        nu=c(0.01), 
        k=c(0.01/0.71), 
    )

    dir_name <- "JFM_DDF"
    dir.create(dir_name)
    tab$name = paste0("JFM_DDF","_scale_",tab$scale, "_bc_", tab$bc)
    tab$xml = paste0(paste0(dir_name,"/",tab$name),".xml")


        tab$output = paste0(paste0("output/",dir_name,"/",tab$name,"/"))
    

    options(digits=10)
    write.csv(tab, "JFM_DDF_template.csv", row.names=FALSE)
    for (i in 1:nrow(tab)) {
        attach(tab[i,,drop=FALSE])
        print(xml)
        sink(xml) # save to a .xml file
?>


<?xml version="1.0"?>
<CLBConfig version="2.0" output="<?%s output ?>">
    <!-- <Geometry nx="672" ny="192" nz="192"> -->
    <Geometry nx="<?%f 672*sizer ?>" ny="<?%f 192*sizer ?>" nz="<?%f 192*sizer ?>" >   
        <Cumulants><Box/></Cumulants>
        <IBB name="border" >
              <STL 
              file="WIP/Benchmarks/JFM/jfm_grid.stl" 
              scale="<?%f sizer*grid_scale ?>" 
              Xrot="0d" 
              x="<?%f sizer*grid_scale*9.25*t0 ?>" 
              y="<?%f sizer*grid_scale*4.3*t0 ?>" 
              z="<?%f sizer*grid_scale*4.3*t0 ?>" 
              side="surface"
            />
      
        </IBB>
        <WVelocity name="Inlet"><Box nx="1"/></WVelocity>
        <EPressure name="Outlet"><Box dx="-1"/></EPressure>



    </Geometry>
    <Model>
        <Params
          InitTemperature="10"
          InitTemperature-Inlet="10"
          InitTemperature-Outlet="10"
          InitTemperature-Dirichlet="11"

          InitHeatFlux-neumann_hot="0.01"
        />

      <Params 
        Velocity="0.05"

        conductivity="<?%f k ?>"

        nu_buffer="0.1"
        conductivity_buffer="0.1"

        h_stability_enhancement="1."
        cp="1."
        material_density="1."
      />

      <Params VelocityX="<?%f Re*nu/(sizer*grid_scale*t0) ?>" />
<!--         <Params CylinderCenterX="207"/>
        <Params CylinderCenterY="96"/> -->
    </Model>
    <Solve Iterations="10"/>
    <Failcheck Iterations="2000" nx="10" ny="192" nz="192" />
    <Solve Iterations="500000" > <VTK Iterations="50000" what="T,U,Rho"/> </Solve>
    <!-- <SaveMemoryDump Iterations="250000" file="test.tclbdump"/> -->
    <Average><Solve Iterations="400000"/></Average>
    <Solve Iterations="100000" /> <VTK Iterations="50000" what="T,U,Rho"/> </Solve>
  </CLBConfig>


<?R
    sink()
    detach()
}
?>
