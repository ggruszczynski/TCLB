
<?R
    tab = expand.grid(
	    nu=c(3e-04), 
	    k=c(3e-05), 
	    sizer=c(0.25), 
	    Re=c(100), 
	    collision=c("CM","CM_HIGHER"), 
	    is_nu_limiter=c(T),
	    is_k_limiter=c(F,T)
    )

    dir_name <- "batch_HotKarmanLimiters3D"
    dir.create(dir_name)
    # tab$name = paste0(dir_name,"/HotKarmanLimiters3D_template", "_nu_",tab$nu,"_k_",tab$k)
    # tab$xml = paste0(tab$name,".xml")

    tab$name = paste0("HotKarmanLimiters3D_template_",tab$collision, "_Re_",tab$Re, "_sizer_", tab$sizer, "_nu_",tab$nu, "_isnulim_", tab$is_nu_limiter, "_k_",tab$k, "_isklim_", tab$is_k_limiter )

    tab$xml = paste0(paste0(dir_name,"/",tab$name),".xml")

    tab$output = paste0(paste0("output/",dir_name,"/",tab$name,"/")) # set local output path
    # tab$output = paste0(paste0("/net/scratch/people/plgmuaddieb/output/",dir_name,"/",tab$name, "/")) # set path to $SCRATCH partition on HPC cluster

    write.csv(tab, "HotKarmanLimiters3D_template.csv", row.names=FALSE)
    for (i in 1:nrow(tab)) {
        attach(tab[i,,drop=FALSE])
        print(xml)
        sink(xml) # save to a .xml file
?>

<?xml version="1.0"?>
<CLBConfig version="2.0" output="<?%s output ?>">
<!--     <Units>
        <Params size="1m" gauge="<?%f sizer ?>"/>
    </Units> -->
    <Geometry nx="<?%f 1000*sizer ?>" ny="<?%f 150*sizer ?>" nz="3" >   
      <<?%s collision ?>> <Box/> </<?%s collision ?>>  
        <WVelocity><Inlet/></WVelocity>
        <!-- <EPressure><Outlet/></EPressure> -->
        <!-- <EConvect><Outlet/></EConvect> -->
        <ENeumann><Outlet/></ENeumann>

        <Wall mask="ALL">
            <!-- <Channel/> -->
          <Cylinder dx="<?%f 285*sizer ?>" dy="<?%f 60*sizer ?>" nx="<?%f 30*sizer ?>" ny="<?%f 30*sizer ?>" nz="<?%f 50*sizer ?>"/>
        </Wall>

        <HeaterDirichletTemperature  name="dirichlet_hot"> 
          <Cylinder dx="<?%f 285*sizer ?>" dy="<?%f 60*sizer ?>" nx="<?%f 30*sizer ?>" ny="<?%f 30*sizer ?>" nz="<?%f 50*sizer ?>"/>
        </HeaterDirichletTemperature>  

        <MeasurmentArea>
            <Cylinder dx="<?%f 285*sizer ?>" dy="<?%f 60*sizer ?>" nx="<?%f 30*sizer ?>" ny="<?%f 30*sizer ?>" nz="<?%f 50*sizer ?>"/>
            <!-- <Outlet/> -->
        </MeasurmentArea>
    </Geometry>

    <Model>
        <Params
            InitTemperature="0"
            InitTemperature-dirichlet_hot="1"
            InitTemperature-dirichlet_cold="0"
            />
        <Params/>

        <Params
            nu="<?%f nu ?>"
            conductivity="<?%f k ?>"

            h_stability_enhancement="1."
            cp="1"
            material_density="1"
            />
        <Params/>

        <?R
        if(!is_nu_limiter)
			{
			cat(sprintf("<Params nu_buffer=\"%f\" />\n", nu))
			#cat(sprintf("x=%.2f\n", nu))
			}
		?>
		<?R
        if(!is_k_limiter)
			{
			cat(sprintf("<Params conductivity_buffer=\"%f\" />\n", nu))
			}
		?>
        <Params VelocityX="<?%f Re*nu/(30*sizer) ?>" />
        <!-- <Params VelocityX="1.0E-02" /> -->
    </Model>

<Failcheck Iterations="100" nx="<?%f 1000*sizer ?>" ny="<?%f 150*sizer ?>" nz="3" />
<!-- <TXT Iterations="50000" what="T,U"/> -->
<Log Iterations="100"/>
<!-- <Solve Iterations="120000"> </Solve> -->
<Solve Iterations="500000"> <VTK Iterations="100"/> </Solve>
</CLBConfig>

<?R
    sink()
    detach()
}
?>
