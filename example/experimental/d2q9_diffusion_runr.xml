<?xml version="1.0"?>
<CLBConfig version="2.0" output="output/diffusion-test/">
	<Geometry nx="512" ny="512">
		<!-- <SRT_diffusion><Box/></SRT_diffusion> -->
		<!-- <MRT_no_diffusion_grad_FD><Box/></MRT_no_diffusion_grad_FD> -->
		<MRT_no_diffusion_grad_moments><Box/></MRT_no_diffusion_grad_moments>
		<!-- <MRT_no_diffusion_lp_FD><Box/></MRT_no_diffusion_lp_FD> -->
		<None name="special">
			<!-- <Box dx="400" dy="400" nx="25" ny="25"/> -->
			<!-- <Box dx="40" dy="40" nx="150" ny="150"/> -->
		</None>
	</Geometry>
	<Model>
        <Param name="Init_PhaseField" value="0.0"/>
		<Param name="Init_PhaseField" zone="special" value="1.0" />
		<Param name="diffusivity_phi" value="0.0001"/>
    </Model>
    <!-- <VTK Iterations="1000" /> -->
    	<RunR >
		# GH
		print("-------------------------")
		#print(Solver$Geometry$X)
		#print(Solver$Geometry$Y)
		#print(Solver$Geometry$Z)
		#print(length(Solver$Geometry$X))
		#print(length(Solver$Geometry$Y))
		#print("========================")
		#print(round(as.vector(Solver$Geometry$X)))
		#print("xxxx")
		#print(round(as.vector(Solver$Geometry$X)- 0.5))
		#print("xxxx")
		#print(round(as.vector(Solver$Geometry$X)- 0.5) %% nx)

		X = Solver$Geometry$X
		nx = dim(X)[1]
		ny = dim(X)[2]
		nz = dim(X)[3]

		x_center = nx/2
		y_center = ny/2
		z_center = nz/2
		
		dx = Solver$Geometry$X - x_center
		dy = Solver$Geometry$Y - y_center
		dz = Solver$Geometry$Z - z_center
		L = dx*dx + dy*dy

		D = 2 # no of dimensions
		C0 = 1 # initial concentration
		Sigma2 = 250 # initial variance

        phi0 = C0
		#phi0 = phi0/(2*pi*Sigma2)^(D/3)
		phi0 = phi0*exp(-L/(2*Sigma2))
		# phi0 = phi0 + 10 # HACK: for better preview. Cumulants cannot be 0, so lets set the reference level to 10.

		Solver$Fields$Init_PhaseField_R[] = phi0
		
		Solver$Actions$InitFromFields() # Initiate phi from Init_PhaseField_R
	</RunR>
    <Solve Iterations="10"><VTK Iterations="1"/></Solve>
	<!-- <Solve Iterations="100"><VTK Iterations="10"/></Solve> -->	<!-- Smoothing the population -->
	<!-- <Geometry><None mask="ADDITIONALS"><Box nx="512" ny="512"/></None></Geometry> -->
	<Solve Iterations="100000"><VTK Iterations="5000"/></Solve>
</CLBConfig>
